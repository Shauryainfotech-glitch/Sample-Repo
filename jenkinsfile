pipeline {
    agent any

    tools {
        nodejs 'Node18'  // Must match the tool name configured in Jenkins
    }

    stages {
        stage('Checkout Code') {
            steps {
                echo "ğŸ”„ Cloning repository"
                git url: 'https://github.com/Shauryainfotech-glitch/Sample-Repo.git', branch: 'main'
            }
        }

        stage('Setup Node.js') {
            steps {
                echo "ğŸ”§ Checking Node and npm versions"
                sh 'node -v'
                sh 'npm -v'
            }
        }

        stage('Build Frontend') {
            steps {
                echo "ğŸ“¦ Installing frontend dependencies and building"
                dir('client') {
                    sh 'npm install'
                    sh 'npm run build'
                }
            }
        }

        stage('Prepare Backend') {
            steps {
                echo "ğŸ“¦ Installing backend dependencies"
                dir('server') {
                    sh 'npm install'
                    // Optional: Run backend tests here
                    // sh 'npm test'
                }
            }
        }

        stage('Archive Frontend Build Artifacts') {
            steps {
                echo "ğŸ—ƒï¸ Archiving frontend build artifacts"
                archiveArtifacts artifacts: "client/build/**/*", fingerprint: true
            }
        }

        stage('Deploy Backend') {
            steps {
                echo "ğŸš€ Deploying backend"
                dir('server') {
                    // Replace this with your backend deploy commands
                    echo "Deploy backend here (e.g. scp files, restart service)"
                }
            }
        }

        stage('Deploy Frontend') {
            steps {
                echo "ğŸš€ Deploying frontend"
                dir('client') {
                    // Replace this with your frontend deploy commands
                    echo "Deploy frontend here (e.g. upload build to server/CDN)"
                }
            }
        }
    }

    post {
        success {
            echo "âœ… Pipeline completed successfully"
        }
        failure {
            echo "âŒ Pipeline failed! Check logs for details"
        }
        always {
            echo "ğŸ§¹ Cleaning up"
        }
    }
}
